# 1. Name of the automation
name: Train-on-Azure

# 2. The Trigger: When should this run?
on: 
  push:
    branches: [ main ]  # Runs every time you push to the main branch

jobs:
  train-model:
    runs-on: ubuntu-latest # The temporary VM GitHub gives you to run these commands
    
    steps:
      # 3. Pull your code from GitHub into the temporary VM
      - name: Check out repo
        uses: actions/checkout@v3

      # 4. Log into Azure using the "Secret" you created
      - name: Azure login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      # 5. Install the Azure ML extension for the CLI
      - name: Install ML Extension
        run: az extension add -n ml

      # 6. The "Magic" Command
      # This tells Azure ML to take your 'job.yml' and start the training cluster
      - name: Submit Job to Azure ML
        run: |
          az ml job create -f job.yml \
            --workspace-name YOUR_WORKSPACE_NAME \
            --resource-group YOUR_RESOURCE_GROUP
